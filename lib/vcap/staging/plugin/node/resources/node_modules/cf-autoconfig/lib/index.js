/*
 * Cloud Foundry auto-configuration
 */

(function () {

  if (require("cf-runtime").CloudApp.runningInCloud) {

    var originalCache = require.cache;

    try {
      require("./server").setup();
      require("./mongodb").setup();
      require("./redis").setup();
      require("./mysql").setup();
      require("./postgresql").setup();
      require("./rabbitmq").setup();

      delete originalCache;
    }
    catch (e) {
      // Something went wrong, rollback
      process.stderr.write("Auto-configuration for Cloud Foundry failed");
      require.cache = originalCache;
    }
  }
})();
