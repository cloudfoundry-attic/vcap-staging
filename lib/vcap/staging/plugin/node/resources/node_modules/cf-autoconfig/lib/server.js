/*
 * Cloud Foundry auto-configuration
 * Server connection
 *
 * Auto-configured node modules:
 *
 * "net"
 * - Server.listen()
 */

var cf = require("cf-runtime");

function setupServer () {
  var net = require("net");

  var oldListen = net.Server.prototype.listen;

  net.Server.prototype.listen = function () {
    var lastArg = arguments[arguments.length - 1];
    if (typeof lastArg == "function") {
      return oldListen.call(this, cf.CloudApp.port, cf.CloudApp.host, lastArg);
    }
    else {
      return oldListen.call(this, cf.CloudApp.port, cf.CloudApp.host);
    }
  };
}

exports.setup = setupServer;